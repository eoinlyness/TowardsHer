package uk.ac.qub.activitymonitor.functions;

import android.content.Context;
import android.util.Log;

import com.google.gson.Gson;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.lang.reflect.Type;

public class ClassSaver {

    private Gson gson = new Gson();

    /**
     * Save Class to JSON String
     *
     * @param Class Class you want to save
     * @return String in JSON Format
     */
    public String saveClass(Object Class) {
        try {
            return gson.toJson(Class);
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return null;
        }
    }


    /**
     * Load Class from String
     *
     * @param Json String
     * @param type Type of class
     * @return Object
     */
    public Object loadClass(String Json, Type type) {
        try {
            return gson.fromJson(Json, type);
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return null;
        }
    }


    /**
     * Save class to file
     *
     * @param ClassToSave Class you want to save
     * @param Dirname     Directory name
     * @param Filename    File name
     * @param context     context
     * @return boolean, true if successful
     */
    public boolean saveClassToFile(Object ClassToSave, String Dirname, String Filename, Context context) {
        try {
            File dir = context.getDir(Dirname, Context.MODE_PRIVATE);
            File file = new File(dir, Filename);
            FileOutputStream outStream = new FileOutputStream(file);


            byte[] bytes = gson.toJson(ClassToSave).getBytes();
            outStream.write(bytes);

            outStream.flush();
            outStream.close();

            return true;
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return false;
        }
    }


    /**
     * Save class to file
     *
     * @param ClassToSave Class you want to save
     * @param file        File to save
     * @return boolean, true if successful
     */
    public boolean saveClassToSpecificFile(Object ClassToSave, File file) {
        try {
            FileOutputStream outStream = new FileOutputStream(file);

            byte[] bytes = gson.toJson(ClassToSave).getBytes();
            outStream.write(bytes);

            outStream.flush();
            outStream.close();

            return true;
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return false;
        }
    }

    /**
     * File exists?
     *
     * @param Dirname  Directory name
     * @param Filename File name
     * @param context  context
     * @return boolean, true if exists
     */
    public boolean fileExist(String Dirname, String Filename, Context context) {
        File dir = context.getDir(Dirname, Context.MODE_PRIVATE);
        Log.d("Path", dir.getPath());
        dir.mkdirs();
        File file = new File(dir, Filename);

        return file.exists();
    }


    /**
     * Return internal storage file
     *
     * @param Dirname  Directory name
     * @param Filename File name
     * @param context  Context
     * @return File
     */
    public File getFile(String Dirname, String Filename, Context context) {
        File dir = context.getDir(Dirname, Context.MODE_PRIVATE);
        File file = new File(dir, Filename);

        return file;
    }

    /**
     * Load class from file
     *
     * @param type     Class type
     * @param Dirname  Directory name
     * @param Filename File name
     * @param context  context
     * @return Object
     */
    public Object loadClassFromFile(Type type, String Dirname, String Filename, Context context) {
        try {
            File dir = context.getDir(Dirname, Context.MODE_PRIVATE);
            File file = new File(dir, Filename);

            FileInputStream inStream = new FileInputStream(file);
            int n;

            StringBuffer text = new StringBuffer("");

            byte[] buffer = new byte[1024];

            while ((n = inStream.read(buffer)) != -1) {
                text.append(new String(buffer, 0, n));
            }
            return gson.fromJson(text.toString(), type);
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return null;
        }
    }


    /**
     * Load class from file
     *
     * @param type Type of class
     * @param file File to load
     * @return Object
     */
    public Object loadClassFromSpecificFile(Type type, File file) {
        try {

            FileInputStream inStream = new FileInputStream(file);
            int n;

            StringBuffer text = new StringBuffer("");

            byte[] buffer = new byte[1024];

            while ((n = inStream.read(buffer)) != -1) {
                text.append(new String(buffer, 0, n));
            }
            return gson.fromJson(text.toString(), type);
        } catch (Exception ex) {
            Log.w("ClassSaver", ex);
            return null;
        }
    }


}
